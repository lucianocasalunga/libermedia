{% extends "base.html" %}
{% block title %}Login Manual{% endblock %}
{% block content %}

<div class="min-h-[70vh] flex items-center justify-center">
  <div class="bg-white/95 dark:bg-gray-900/95 rounded-2xl shadow-2xl p-10 w-full max-w-md">
    
    <h1 class="text-3xl font-bold mb-4 text-center">Entrar com Chave Privada</h1>
    <p class="text-sm text-gray-600 dark:text-gray-400 mb-6 text-center">
      Cole sua chave privada (nsec)
    </p>

    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium mb-2">Chave Privada (nsec)</label>
        <input 
          type="password" 
          id="nsec" 
          placeholder="nsec1..." 
          class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-yellow-500 outline-none"
        >
      </div>

      <button onclick="login()" class="w-full bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-gray-900 font-bold py-3 rounded-lg shadow-lg transition">
        ğŸ”“ Entrar
      </button>
    </div>

    <div class="mt-6 text-center space-y-2">
      <p class="text-sm text-gray-600 dark:text-gray-400">Ainda nÃ£o tem chaves?</p>
      <a href="/cadastro" class="text-yellow-500 font-semibold hover:underline">Criar nova identidade</a>
      <br>
      <a href="/" class="text-sm text-gray-500 hover:text-yellow-500">â† Voltar</a>
    </div>

  </div>
</div>

<script>
async function login() {
  const nsec = document.getElementById('nsec').value.trim();
  
  if (!nsec) {
    alert('âŒ Digite sua chave!');
    return;
  }
  
  if (!nsec.startsWith('nsec1')) {
    alert('âŒ Chave invÃ¡lida! Deve comeÃ§ar com nsec1');
    return;
  }

  try {
    const base = nsec.replace('nsec1', '');
    const npub = 'npub1' + base;
    
    localStorage.setItem('libermedia_npub', npub);
    localStorage.setItem('libermedia_nsec', nsec);
    
    const r = await fetch('/api/auth/login', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({npub: npub})
    });
    
    const d = await r.json();
    
    if (d.status === 'ok') {
      alert('âœ… Login OK!');
      window.location.href = '/dashboard';
    } else {
      alert('âŒ Erro: ' + d.error);
    }
    
  } catch (err) {
    alert('âŒ Erro: ' + err.message);
  }
}
</script>

{% endblock %}
